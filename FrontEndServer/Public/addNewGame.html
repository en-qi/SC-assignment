<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Add Game â€” Game Shop</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{background:#071028;color:#fff;min-height:100vh}
    .card{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04)}
    .form-control, textarea{background:rgba(255,255,255,0.03);color:#fff;border:1px solid rgba(255,255,255,0.06)}
    label, .form-label, .muted{color:#fff}
    .checkbox-list label{display:block}
    select option { color: #000 !important; background:#fff !important; }

    /* Make the Add a New Game heading explicitly white */
    .card h3, h3.mb-3 { color: #ffffff !important; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="newHome.html">Game Shop</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="newHome.html">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="gamesSearch.html">Games</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <div class="card p-3">
      <h3 class="mb-3">Add a New Game</h3>
      <form id="addGameForm">
        <div class="mb-3">
          <label class="form-label">Title</label>
          <input id="GameTitle" class="form-control" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea id="GameDescription" class="form-control" rows="4" required></textarea>
        </div>
        <div class="mb-3">
          <label class="form-label">Image (JPEG)</label>
          <input id="GameImage" type="file" accept="image/jpeg" class="form-control">
        </div>
        <div class="mb-3">
          <label class="form-label">Prices (comma separated per selected platforms)</label>
          <input id="GamePrice" class="form-control" required placeholder="e.g. 59.99,39.99">
        </div>
        <div class="mb-3">
          <label class="form-label">Platforms</label>
          <div id="platform" class="checkbox-list"></div>
        </div>
        <div class="mb-3">
          <label class="form-label">Categories</label>
          <div id="category" class="checkbox-list"></div>
        </div>
        <div class="mb-3">
          <label class="form-label">Published Year</label>
          <input id="GameYear" class="form-control" required placeholder="e.g. 2025">
        </div>
        <div class="d-grid">
          <button id="submit-Game" type="button" class="btn btn-primary">Submit Game</button>
        </div>
      </form>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (function(){
      const apiBase = 'http://localhost:8081';
      let catData = [], platData = [];

      async function loadFilters(){
        try{
          const [catsRes, platsRes] = await Promise.all([fetch(apiBase + '/category/'), fetch(apiBase + '/platform/')]);
          if(catsRes.ok){ catData = await catsRes.json(); document.getElementById('category').innerHTML = catData.map(c=>`<label><input type="checkbox" name="category" value="${c.catID}"> ${c.catname}</label>`).join(''); }
          if(platsRes.ok){ platData = await platsRes.json(); document.getElementById('platform').innerHTML = platData.map(p=>`<label><input type="checkbox" name="platform" value="${p.platID}"> ${p.platform_name}</label>`).join(''); }
        }catch(e){console.error('Could not load filters',e)}
      }

      function getCheckedValues(name){ return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(i=>i.value); }

      document.getElementById('submit-Game').addEventListener('click', async function(){
        const title = document.getElementById('GameTitle').value.trim();
        const description = document.getElementById('GameDescription').value.trim();
        const year = document.getElementById('GameYear').value.trim();
        const price = document.getElementById('GamePrice').value.trim();
        if(!title || !description || !year || !price){ alert('Please fill required fields'); return; }

        const formData = new FormData();
        formData.append('title', title);
        formData.append('description', description);
        const file = document.getElementById('GameImage').files[0]; if(file) formData.append('game_image', file);
        formData.append('year', year);
        formData.append('price', price);
        formData.append('platformid', getCheckedValues('platform').join(','));
        formData.append('categoryid', getCheckedValues('category').join(','));

        const token = localStorage.getItem('Token');
        try{
          const res = await fetch(apiBase + '/game', { method: 'POST', headers: { 'Authorization': 'Bearer ' + token }, body: formData });
          if(res.ok){ alert('Game added successfully'); document.getElementById('addGameForm').reset(); } else { const t = await res.text(); alert('Failed: '+t); }
        }catch(e){ console.error(e); alert('Network error'); }
      });

      // role check
      (async function(){ const token = localStorage.getItem('Token'); if(token){ try{const r=await fetch(apiBase + '/CheckRole',{headers:{'Authorization':'Bearer '+token}}); if(r.ok){const d=await r.json(); if(!(d.role==='Admin')) document.querySelectorAll('.admin-tab').forEach(e=>e.style.display='none'); } }catch(e){console.error(e)} } else document.querySelectorAll('.admin-tab').forEach(e=>e.style.display='none'); })();

      // logout handler (if any link with id Logout exists elsewhere)
      document.querySelectorAll('#Logout').forEach(el=> el && el.addEventListener('click', function(e){ e.preventDefault(); localStorage.clear(); alert('You have successfully Logged out.'); }));

      loadFilters();
    })();
  </script>
</body>
</html>
